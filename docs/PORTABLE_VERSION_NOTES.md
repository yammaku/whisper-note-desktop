# 闪念笔记可移植版本说明

## 完成的改进

### 1. 完全可移植的应用程序
- ✅ 创建了 `闪念笔记.app` - 使用相对路径，可随项目文件夹移动
- ✅ 应用程序自动检测项目位置，无需修改任何配置
- ✅ 包含错误处理，当找不到项目文件时会显示提示

### 2. 相对路径改造
所有脚本现在都使用相对路径：
- ✅ `启动闪念笔记.command` - 自动检测脚本位置
- ✅ `start_web_server.sh` - 使用相对路径
- ✅ `voice_to_notes.sh` - 使用相对路径
- ✅ `voice_to_notes_workflow.py` - 使用PROJECT_ROOT相对路径
- ✅ `web_server.py` - 使用PROJECT_ROOT相对路径

### 3. 新机器支持
- ✅ 创建了 `初始化设置.command` - 一键初始化新环境
- ✅ 创建了详细的安装指南 `docs/SETUP_GUIDE_NEW_MACHINE.md`
- ✅ 自动检查和安装依赖

## 使用方法

### 在当前机器上
直接双击 `闪念笔记.app` 即可使用

### 迁移到新机器
1. 复制整个 `闪念笔记` 文件夹到新机器
2. 双击运行 `初始化设置.command`
3. 按提示设置API密钥（如果需要）
4. 双击 `闪念笔记.app` 开始使用

## 技术细节

### 路径处理
- 应用程序通过 `${BASH_SOURCE[0]}` 获取自身位置
- 从应用包路径向上查找项目根目录
- 所有内部引用都使用相对于项目根的路径

### 错误处理
- 检查项目文件是否存在
- 服务器启动失败时显示错误信息
- API密钥缺失时提供设置指引

### 跨平台考虑
- 使用标准的macOS应用包结构
- 避免硬编码用户目录路径
- 支持不同的Python和FFmpeg安装位置

## 文件变更清单

新增文件：
- `闪念笔记.app/` - 可移植应用程序
- `初始化设置.command` - 环境初始化脚本
- `docs/SETUP_GUIDE_NEW_MACHINE.md` - 新机器安装指南
- `docs/PORTABLE_VERSION_NOTES.md` - 本文档

修改文件：
- `启动闪念笔记.command` - 改用相对路径
- `README.md` - 添加初始化说明和文档链接
- `create_portable_app.sh` - 用于生成可移植应用

## 注意事项

1. **API密钥**：需要在每台新机器上设置
2. **系统依赖**：FFmpeg和Python需要单独安装
3. **权限**：首次运行可能需要授予系统权限

## 测试建议

在新机器上测试时：
1. 确保没有环境变量依赖
2. 测试所有启动方式
3. 验证音频处理和Apple Notes同步功能
4. 检查错误处理是否正常工作